<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <link crossorigin="anonymous" media="all"
        rel="stylesheet"
        href="https://meik2333.com/css/frameworks.css" />
    <link crossorigin="anonymous" media="all"
        rel="stylesheet" href="https://meik2333.com/css/github.css" />
    <link crossorigin="anonymous" media="(prefers-color-scheme: dark)"
        rel="stylesheet" href="https://meik2333.com/css/dark.css" />
    <meta name="viewport" content="width=device-width">

    <title>Django tutorial - MeiK&#39;s blog</title>

    <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://meik2333.com/images/favicon.ico">
    <meta name="theme-color" content="#1e2327">
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-107784973-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>

<body class="env-production emoji-size-boost page-responsive page-profile">
  <div class="position-relative js-header-wrapper ">
    <span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar">
        <span class="progress-pjax-loader-bar top-0 left-0" style="width: 0%;"></span>
    </span>
    <header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner">
        <div class="Header-item d-none d-lg-flex">
            <a class="Header-link" href="https://meik2333.com/" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div
            class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden">
            <div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to"
                role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox"
                aria-expanded="false">
                <div class="position-relative">
                </div>
            </div>
        </div>
        <nav class="d-flex" aria-label="Global">
            <a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a>
        </nav>
        <div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style="margin-right: auto;">
            <a class="Header-link" href="https://meik2333.com/" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div class="Header-item position-relative mr-0 d-none d-lg-flex">
            <details class="details-overlay details-reset">
                <summary class="Header-link" aria-label="View profile and more"
                    data-ga-click="Header, show menu, icon:avatar">
                    
                    <img alt="" class="avatar" src="https://meik2333.com/images/avatar.png" height="20" width="20">
                    
                </summary>
            </details>
        </div>
    </header>
</div>

<div id="start-of-content" class="show-on-focus"></div>
<div id="js-flash-container">
</div>

  
<div class="application-main " data-commit-hovercards-enabled="">
    <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
        <main>
            <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4 ">
                <div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block">
                    <div class="mb-3 d-flex">
                        <h1 class="public css-truncate float-none flex-auto width-fit pl-0">
                            <a class="avatar mr-1" href="https://meik2333.com/about/">
                            
                                <img
                                    src="https://meik2333.com/images/avatar.png" width="26" height="26">
                            
                            </a>
                            <span class="author"><a
                                    href="https://meik2333.com/">MeiK</a></span>
                            <span class="path-divider">/</span>
                            <strong itemprop="name" class="css-truncate-target" style="max-width: 410px"><a
                                    href="https://meik2333.com/posts/django-tutorial/">Django tutorial</a></strong>

                            <div class="d-block text-small text-gray">
                                Created <time-ago datetime="2018-02-22" class="no-wrap"
                                    title="Created at 2018/02/22">
                                    2018-02-22</time-ago>
                                <span class="file-info-divider"></span>
                                Modifyed <time-ago datetime="2018-02-22" class="no-wrap"
                                    title="Modified  at 2018/02/22">
                                    2018-02-22</time-ago>
                            </div>
                        </h1>
                    </div>
                </div>




            </div>
            <div class="container-lg clearfix new-discussion-timeline experiment-repo-nav  p-responsive">
                <div class="repository-content ">
                    <div class="Box mt-3 position-relative">
                        <div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
                            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                                2038 Words
                                
                            </div>
                        </div>

                        <div id="readme" class="Box-body readme blob instapaper_body js-code-block-container">
                            <article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><p>通过 django 官网的 polls 项目教程，学习一下建立一个 django 网站所需要的基本的操作。</p>

<h1 id="django-环境搭建">django 环境搭建</h1>

<p>django 作为一个 Python 的包，可以通过包管理器 pip 来安装，当然也可以在官网下载，或者 clone GitHub 上的项目安装。</p>

<p>截至我写这篇操作记录的时候，官方最新的发行版是 django2.0 ，我个人强烈建议使用最新的 django2.0 。因为 2.0 之后添加了很多极其美滋滋的操作，比如 <code>&lt;int:score&gt;</code> 这种操作，比如 <code>path.include</code> 。</p>

<p>我在一年多之前写过一个 django 项目，当时使用的是 Python2 + djang1.x ，因此再拾起 django2.0 ，看到这些新的神奇的操作，发现 django 和我当时用的已经大不一样了，借鉴了 flask 的很多优秀的地方。直接上手 2.0 会让我们的生活更加美好～</p>

<hr />

<h1 id="创建一个项目">创建一个项目</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">django-admin startproject &lt;mysite&gt;</code></pre></div>
<hr />

<h1 id="启动内置的开发服务器">启动内置的开发服务器</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py runserver</code></pre></div>
<p>注意：django2.0 之后仅支持 Python3，因此在同时有 Python2 和 Python3 环境的电脑下，需要用 python3 来替换 python</p>

<p>默认情况下该命令在内部 ip 的 8000 端口启动开发服务器，如果想要更改其端口，可以修改命令行参数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python3 manage.py runserver <span style="color:#ae81ff">8080</span></code></pre></div>
<p>该命令将在 8080 端口启动服务，而如果要监听所有的 ip（在其他电脑上访问）：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py runserver <span style="color:#ae81ff">0</span>:8080</code></pre></div>
<p>0 是 0.0.0.0 的快捷方式</p>

<hr />

<h1 id="创建一个应用">创建一个应用</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py startapp &lt;myapp&gt;</code></pre></div>
<p>这将创建一个目录 <myapp></p>

<hr />

<h1 id="urls">urls</h1>

<p>django 通过一个名为 urlpatterns 的列表来匹配路由，列表中的每一项可以为一个路由对应一个函数（或类），也可以通过 include 的方式包含其他文件里面的路由规则。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">urlpatterns <span style="color:#f92672">=</span> [
    path(<span style="color:#e6db74">&#39;&#39;</span>, views<span style="color:#f92672">.</span>index, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;index&#39;</span>),  <span style="color:#75715e"># 对应 views 里面的 index 函数</span>
    path(<span style="color:#e6db74">&#39;myapp/&#39;</span>, include(<span style="color:#e6db74">&#39;myapp.urls&#39;</span>)),  <span style="color:#75715e"># 包含 myapp 的路由规则</span>
]</code></pre></div>
<h2 id="path-的参数">path 的参数</h2>

<h3 id="route">route</h3>

<p>route 是路由匹配的规则， path 不搜索请求的域名和 get 请求的参数，比如 /myapp/ 和 /myapp/?id=1 将搜索到同一个路由</p>

<h3 id="view">view</h3>

<p>当 django 找到一个匹配的路由时，会把 HttpRequest 对象作为第一个参数传递给指定的视图函数</p>

<h3 id="kwargs">kwargs</h3>

<p>传递给视图函数的任意参数，在教程中没有应用</p>

<h3 id="name">name</h3>

<p>该路由的命名，便于在其他文件中明确的引用它（尤其是模板中）。</p>

<hr />

<h1 id="数据库设置">数据库设置</h1>

<p>django 的数据库设置在 mysite/settings.py 中，默认情况下 django 使用 sqlite3 数据库，这是一个基于文件的轻量级数据库，无需账号密码或端口等配置，可以直接使用。</p>

<p>如果想要使用其他 SQL数据库（如 MySQL 或者 PostgreSQL），那么需要修改 settings.py 中的 DATABASES 设置。当使用 sqlite3 数据库时，只需要填写 engine 与 name 即可，如果要使用其他数据库，则还需要端口、账号与密码等信息。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 使用 sqlite3</span>
DATABASES <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;default&#39;</span>: {
        <span style="color:#e6db74">&#39;ENGINE&#39;</span>: <span style="color:#e6db74">&#39;django.db.backends.sqlite3&#39;</span>,
        <span style="color:#e6db74">&#39;NAME&#39;</span>: <span style="color:#e6db74">&#39;mydatabase&#39;</span>,
    }
}


<span style="color:#75715e"># 使用 postgresql</span>
DATABASES <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;default&#39;</span>: {
        <span style="color:#e6db74">&#39;ENGINE&#39;</span>: <span style="color:#e6db74">&#39;django.db.backends.postgresql&#39;</span>,
        <span style="color:#e6db74">&#39;NAME&#39;</span>: <span style="color:#e6db74">&#39;mydatabase&#39;</span>,
        <span style="color:#e6db74">&#39;USER&#39;</span>: <span style="color:#e6db74">&#39;mydatabaseuser&#39;</span>,
        <span style="color:#e6db74">&#39;PASSWORD&#39;</span>: <span style="color:#e6db74">&#39;mypassword&#39;</span>,
        <span style="color:#e6db74">&#39;HOST&#39;</span>: <span style="color:#e6db74">&#39;127.0.0.1&#39;</span>,
        <span style="color:#e6db74">&#39;PORT&#39;</span>: <span style="color:#e6db74">&#39;5432&#39;</span>,
    }
}


<span style="color:#75715e"># 一些其他的 engine</span>
<span style="color:#75715e"># &#39;django.db.backends.postgresql&#39;</span>
<span style="color:#75715e"># &#39;django.db.backends.mysql&#39;</span>
<span style="color:#75715e"># &#39;django.db.backends.sqlite3&#39;</span>
<span style="color:#75715e"># &#39;django.db.backends.oracle&#39;</span></code></pre></div>
<p>在完成 settings.py 中的数据库设置后，可以通过 migrate 命令来创建必要的数据库表。要注意， mingrate 命令创建的数据库表同时基于 settings.py 的设置与数据库迁移脚本（之后会介绍如何创建数据库迁移脚本）。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py migrate</code></pre></div>
<hr />

<h1 id="时区和语言设置">时区和语言设置</h1>

<p>在启动项目之前，需要先修改项目对应的时区与语言。时区的作用不言而喻，而修改默认语言，可以使自带的 admin 后台管理变成中文的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">LANGUAGE_CODE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;zh-Hans&#39;</span>  <span style="color:#75715e"># 修改语言为中文</span>
TIME_ZONE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Asia/Shanghai&#39;</span>  <span style="color:#75715e"># 修改时区</span></code></pre></div>
<hr />

<h1 id="创建模型">创建模型</h1>

<p>django 推崇 Don’t repeat yourself (DRY) 原则，数据库迁移脚本中的模型将完全来源于你在代码中定义的模型。数据库迁移脚本将自动从你编写的模型中推断出迁移命令，不需要自己手动编写。此处以 django 的教程 polls 来介绍如何编写模型的定义。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Question</span>(models<span style="color:#f92672">.</span>Model):
    question_text <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
    pub_date <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>DateTimeField(<span style="color:#e6db74">&#39;date published&#39;</span>)


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Choice</span>(models<span style="color:#f92672">.</span>Model):
    question <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(Question, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
    choice_text <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>)
    votes <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(default<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)</code></pre></div>
<p>关于这些字段的意思和使用方法，可以参考我的另一篇博客 <a href="http://meik2333.com/index.php/archives/4/">Field types</a> 。</p>

<p>django 通过这些模型的定义代码来创建数据库表和创建访问 API ，但是首先，我们需要告诉我们的项目，我们创建了一个新的应用。</p>

<hr />

<h1 id="激活模型">激活模型</h1>

<p>为了将应用包含在我们的项目中，我们需要在 settings.py 中添加其配置。以 polls 应用为例： polls 的 PollsConfig 包含在 polls/apps.py 文件中，其对应的路径为 &lsquo;polls.apps.PollsConfig&rsquo; ，编辑 settings.py 文件，将其添加至 INSTALLED_APPS 中：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">INSTALLED_APPS  <span style="color:#f92672">=</span>  [ 
    <span style="color:#e6db74">&#39;polls.apps.PollsConfig&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
    <span style="color:#e6db74">&#39;django.contrib.admin&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
    <span style="color:#e6db74">&#39;django.contrib.auth&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
    <span style="color:#e6db74">&#39;django.contrib.contenttypes&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
    <span style="color:#e6db74">&#39;django.contrib.sessions&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
    <span style="color:#e6db74">&#39;django.contrib.messages&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
    <span style="color:#e6db74">&#39;django.contrib.staticfiles&#39;</span> <span style="color:#960050;background-color:#1e0010">，</span>
]</code></pre></div>
<p>现在 django 项目已经知道应该包含 polls 应用，此时运行另一个命令：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py makemigrations polls</code></pre></div>
<p>通知 django 已经对模型进行了修改，重新生成数据库迁移脚本，可以通过以下命令进行查看：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py sqlmigrate polls <span style="color:#ae81ff">0001</span></code></pre></div>
<p>之后，重新运行数据库迁移脚本以使刚刚对模型的修改生效。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py migrate</code></pre></div>
<p>请记住进行模型修改需要做的三个步骤：</p>

<ol>
<li>修改你的模型（models.py）</li>
<li>创建迁移脚本 python manage.py makemigrations</li>
<li>运行迁移脚本 python manage.py migrate</li>
</ol>

<hr />

<h1 id="playing-with-the-api">Playing with the API</h1>

<p>请参阅<a href="https://docs.djangoproject.com/en/2.0/intro/tutorial02/#playing-with-the-api">官方文档</a> 。</p>

<hr />

<h1 id="创建管理员用户">创建管理员用户</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">python manage.py createsuperuser</code></pre></div>
<p>按照提示输入账号密码与邮箱即可。</p>

<hr />

<h1 id="在管理页面显示自己的模型">在管理页面显示自己的模型</h1>

<p>为了在 django 自带的 admin 中管理我们自己创建的模型，需要将模型注册到 admin ，修改 polls/admin.py</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> django.contrib <span style="color:#f92672">import</span> admin

<span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Question

admin<span style="color:#f92672">.</span>site<span style="color:#f92672">.</span>register(Question)</code></pre></div>
<hr />

<h1 id="render">render()</h1>

<p>一个视图的函数应该返回一个 Response 对象，然而在返回一个渲染后的模板时，我们却不需要费力去自己构建一个 Response 对象。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> django.shortcuts <span style="color:#f92672">import</span> render

<span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Question


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(request):
    latest_question_list <span style="color:#f92672">=</span> Question<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>order_by(<span style="color:#e6db74">&#39;-pub_date&#39;</span>)[:<span style="color:#ae81ff">5</span>]
    context <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;latest_question_list&#39;</span>: latest_question_list}
    <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;polls/index.html&#39;</span>, context)</code></pre></div>
<hr />

<h1 id="get-object-or-404">get_object_or_404()</h1>

<p>我们可能会需要在没有找到一个对象的时候给出 404 的错误，这时候 get_object_or_404() 就很有用了。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> django.shortcuts <span style="color:#f92672">import</span> get_object_or_404, render

<span style="color:#f92672">from</span> .models <span style="color:#f92672">import</span> Question
<span style="color:#75715e"># ...</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">detail</span>(request, question_id):
    question <span style="color:#f92672">=</span> get_object_or_404(Question, pk<span style="color:#f92672">=</span>question_id)
    <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#39;polls/detail.html&#39;</span>, {<span style="color:#e6db74">&#39;question&#39;</span>: question})</code></pre></div>
<hr />

<h1 id="为-urls-模块命名">为 urls 模块命名</h1>

<p>如果您开发的项目中包含多个应用，那么这些应用之中可能包含了相同 name 的 url ，可以通过给 urls 命名的方式防止在模板中引用的时候冲突。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># polls/urls.py</span>
<span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path

<span style="color:#f92672">from</span> . <span style="color:#f92672">import</span> views

app_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;polls&#39;</span>
urlpatterns <span style="color:#f92672">=</span> [
    path(<span style="color:#e6db74">&#39;&#39;</span>, views<span style="color:#f92672">.</span>index, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;index&#39;</span>),
    path(<span style="color:#e6db74">&#39;&lt;int:question_id&gt;/&#39;</span>, views<span style="color:#f92672">.</span>detail, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;detail&#39;</span>),
    path(<span style="color:#e6db74">&#39;&lt;int:question_id&gt;/results/&#39;</span>, views<span style="color:#f92672">.</span>results, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;results&#39;</span>),
    path(<span style="color:#e6db74">&#39;&lt;int:question_id&gt;/vote/&#39;</span>, views<span style="color:#f92672">.</span>vote, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;vote&#39;</span>),
]</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"># polls/templates/polls/index.html
&lt;<span style="color:#f92672">li</span>&gt;&lt;<span style="color:#f92672">a</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;polls:detail&#39; question.id %}&#34;</span>&gt;{{ question.question_text }}&lt;/<span style="color:#f92672">a</span>&gt;&lt;/<span style="color:#f92672">li</span>&gt;</code></pre></div>
<hr />

<h1 id="一个简单的-form-示例">一个简单的 form 示例</h1>

<p>{% raw %}</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">h1</span>&gt;{{ question.question_text }}&lt;/<span style="color:#f92672">h1</span>&gt;

{% if error_message %}&lt;<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">strong</span>&gt;{{ error_message }}&lt;/<span style="color:#f92672">strong</span>&gt;&lt;/<span style="color:#f92672">p</span>&gt;{% endif %}

&lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% url &#39;polls:vote&#39; question.id %}&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;post&#34;</span>&gt;
{% csrf_token %}
{% for choice in question.choice_set.all %}
    &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;radio&#34;</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;choice&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;choice{{ forloop.counter }}&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ choice.id }}&#34;</span> /&gt;
    &lt;<span style="color:#f92672">label</span> <span style="color:#a6e22e">for</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;choice{{ forloop.counter }}&#34;</span>&gt;{{ choice.choice_text }}&lt;/<span style="color:#f92672">label</span>&gt;&lt;<span style="color:#f92672">br</span> /&gt;
{% endfor %}
&lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Vote&#34;</span> /&gt;
&lt;/<span style="color:#f92672">form</span>&gt;</code></pre></div>
<p>django 的表单提交默认有 csrf 防跨站检测，需要在 form 中添加 {% csrf_token %} 以自动添加一个隐藏的 csrf 字段。
{% endraw %}</p>

<hr />

<h1 id="测试">测试</h1>

<p>django 中的<a href="https://docs.djangoproject.com/en/2.0/intro/tutorial05/">测试</a></p>

<hr />

<h1 id="自定义管理表单">自定义管理表单</h1>

<p>django 自带的 admin 功能及其强大，通过自定义，可以实现很多强大的功能。</p>

<p>这一章的篇幅较长且操作较为分散，直接给出官网的<a href="https://docs.djangoproject.com/en/2.0/intro/tutorial07/">文档</a> 。</p>

<p>如果想要做深入的 admin 的自定义，那么可以看一下下面三个文档：</p>

<ol>
<li><p><a href="https://docs.djangoproject.com/en/2.0/ref/contrib/admin/">The Django admin site</a></p></li>

<li><p><a href="https://docs.djangoproject.com/en/2.0/ref/contrib/admin/actions/">Admin actions</a></p></li>

<li><p><a href="https://docs.djangoproject.com/en/2.0/ref/contrib/admin/admindocs/">The Django admin documentation generator</a></p></li>
</ol></article>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="utterances"></div>

<script>
	var systemThemeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
	var systemTheme = systemThemeMediaQuery.matches ? 'dark' : 'light';
	var utterancesTheme = systemTheme === 'dark' ? 'github-dark' : 'github-light';
	var utterancesScript = document.createElement('script');
	utterancesScript.src = 'https://utteranc.es/client.js';
	utterancesScript.setAttribute('repo', 'MeiK2333\/MeiK2333.github.io');
	utterancesScript.setAttribute('issue-term', 'title');
	utterancesScript.setAttribute('theme', utterancesTheme);
	utterancesScript.setAttribute('crossorigin', 'anonymous');
	utterancesScript.setAttribute('async', '');
	document.querySelector('.utterances').appendChild(utterancesScript);
</script>
<noscript>Please enable JavaScript to view the comments</noscript>



  <div class="footer container-lg width-full p-responsive" role="contentinfo">
    <div
        class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
            <li class="mr-3 mr-lg-0"></a></li>
        </ul>

        <a aria-label="Homepage" title="MeiK&#39;s blog" class="footer-octicon d-none d-lg-block mx-lg-4"
            href="https://meik2333.com/">
            <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
        </a>
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        </ul>
    </div>
    <div class="d-flex flex-justify-center pb-6">
        <span class="f6 text-gray-light"></span>
    </div>
</div>

<script crossorigin="anonymous"
    type="application/javascript" src="https://meik2333.com/js/frameworks.js"></script>

<script crossorigin="anonymous"
    type="application/javascript" src="https://meik2333.com/js/github-bootstrap.js"></script>
<script src="https://meik2333.com/js/stop.js"></script>
<script src="https://meik2333.com/js/contributions.js"></script>

</body>

</html>