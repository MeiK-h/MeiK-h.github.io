<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>MeiK&#39;s blog  | Django tutorial</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.58.3" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    
    
      <link href="/dist/css/app.d98f2eb6bcd1eaedb7edf166bd16af26.css" rel="stylesheet">
    

    

    
      
    

    
    
    <meta property="og:title" content="Django tutorial" />
<meta property="og:description" content="通过 django 官网的 polls 项目教程，学习一下建立一个 django 网站所需要的基本的操作。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://meik2333.com/posts/django-tutorial/" />
<meta property="article:published_time" content="2018-02-22T21:40:00+00:00" />
<meta property="article:modified_time" content="2018-02-22T21:40:00+00:00" />
<meta itemprop="name" content="Django tutorial">
<meta itemprop="description" content="通过 django 官网的 polls 项目教程，学习一下建立一个 django 网站所需要的基本的操作。">


<meta itemprop="datePublished" content="2018-02-22T21:40:00&#43;00:00" />
<meta itemprop="dateModified" content="2018-02-22T21:40:00&#43;00:00" />
<meta itemprop="wordCount" content="578">



<meta itemprop="keywords" content="Python,Django," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Django tutorial"/>
<meta name="twitter:description" content="通过 django 官网的 polls 项目教程，学习一下建立一个 django 网站所需要的基本的操作。"/>

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://meik2333.com" class="f3 fw2 hover-white no-underline white-90 dib">
      MeiK&#39;s blog
    </a>
    <div class="flex-l items-center">
      

      
      











    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">

    <header class="mt4 w-100">
      <p class="f6 b helvetica tracked">
          
        POSTS
      </p>
      <h1 class="f1 athelas mb1">Django tutorial</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2018-02-22T21:40:00Z">February 22, 2018</time>
      
      
    </header>

    <section class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>通过 django 官网的 polls 项目教程，学习一下建立一个 django 网站所需要的基本的操作。</p>

<h1 id="django-环境搭建">django 环境搭建</h1>

<p>django 作为一个 Python 的包，可以通过包管理器 pip 来安装，当然也可以在官网下载，或者 clone GitHub 上的项目安装。</p>

<p>截至我写这篇操作记录的时候，官方最新的发行版是 django2.0 ，我个人强烈建议使用最新的 django2.0 。因为 2.0 之后添加了很多极其美滋滋的操作，比如 <code>&lt;int:score&gt;</code> 这种操作，比如 <code>path.include</code> 。</p>

<p>我在一年多之前写过一个 django 项目，当时使用的是 Python2 + djang1.x ，因此再拾起 django2.0 ，看到这些新的神奇的操作，发现 django 和我当时用的已经大不一样了，借鉴了 flask 的很多优秀的地方。直接上手 2.0 会让我们的生活更加美好～</p>

<hr />

<h1 id="创建一个项目">创建一个项目</h1>

<pre><code class="language-shell">django-admin startproject &lt;mysite&gt;
</code></pre>

<hr />

<h1 id="启动内置的开发服务器">启动内置的开发服务器</h1>

<pre><code class="language-shell">python manage.py runserver
</code></pre>

<p>注意：django2.0 之后仅支持 Python3，因此在同时有 Python2 和 Python3 环境的电脑下，需要用 python3 来替换 python</p>

<p>默认情况下该命令在内部 ip 的 8000 端口启动开发服务器，如果想要更改其端口，可以修改命令行参数</p>

<pre><code class="language-shell">python3 manage.py runserver 8080
</code></pre>

<p>该命令将在 8080 端口启动服务，而如果要监听所有的 ip（在其他电脑上访问）：</p>

<pre><code class="language-shell">python manage.py runserver 0:8080
</code></pre>

<p>0 是 0.0.0.0 的快捷方式</p>

<hr />

<h1 id="创建一个应用">创建一个应用</h1>

<pre><code class="language-shell">python manage.py startapp &lt;myapp&gt;
</code></pre>

<p>这将创建一个目录 <myapp></p>

<hr />

<h1 id="urls">urls</h1>

<p>django 通过一个名为 urlpatterns 的列表来匹配路由，列表中的每一项可以为一个路由对应一个函数（或类），也可以通过 include 的方式包含其他文件里面的路由规则。</p>

<pre><code class="language-python">urlpatterns = [
    path('', views.index, name='index'),  # 对应 views 里面的 index 函数
    path('myapp/', include('myapp.urls')),  # 包含 myapp 的路由规则
]
</code></pre>

<h2 id="path-的参数">path 的参数</h2>

<h3 id="route">route</h3>

<p>route 是路由匹配的规则， path 不搜索请求的域名和 get 请求的参数，比如 /myapp/ 和 /myapp/?id=1 将搜索到同一个路由</p>

<h3 id="view">view</h3>

<p>当 django 找到一个匹配的路由时，会把 HttpRequest 对象作为第一个参数传递给指定的视图函数</p>

<h3 id="kwargs">kwargs</h3>

<p>传递给视图函数的任意参数，在教程中没有应用</p>

<h3 id="name">name</h3>

<p>该路由的命名，便于在其他文件中明确的引用它（尤其是模板中）。</p>

<hr />

<h1 id="数据库设置">数据库设置</h1>

<p>django 的数据库设置在 mysite/settings.py 中，默认情况下 django 使用 sqlite3 数据库，这是一个基于文件的轻量级数据库，无需账号密码或端口等配置，可以直接使用。</p>

<p>如果想要使用其他 SQL数据库（如 MySQL 或者 PostgreSQL），那么需要修改 settings.py 中的 DATABASES 设置。当使用 sqlite3 数据库时，只需要填写 engine 与 name 即可，如果要使用其他数据库，则还需要端口、账号与密码等信息。</p>

<pre><code class="language-python"># 使用 sqlite3
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': 'mydatabase',
    }
}


# 使用 postgresql
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'mydatabase',
        'USER': 'mydatabaseuser',
        'PASSWORD': 'mypassword',
        'HOST': '127.0.0.1',
        'PORT': '5432',
    }
}


# 一些其他的 engine
# 'django.db.backends.postgresql'
# 'django.db.backends.mysql'
# 'django.db.backends.sqlite3'
# 'django.db.backends.oracle'


</code></pre>

<p>在完成 settings.py 中的数据库设置后，可以通过 migrate 命令来创建必要的数据库表。要注意， mingrate 命令创建的数据库表同时基于 settings.py 的设置与数据库迁移脚本（之后会介绍如何创建数据库迁移脚本）。</p>

<pre><code class="language-shell">python manage.py migrate
</code></pre>

<hr />

<h1 id="时区和语言设置">时区和语言设置</h1>

<p>在启动项目之前，需要先修改项目对应的时区与语言。时区的作用不言而喻，而修改默认语言，可以使自带的 admin 后台管理变成中文的。</p>

<pre><code class="language-python">LANGUAGE_CODE = 'zh-Hans'  # 修改语言为中文
TIME_ZONE = 'Asia/Shanghai'  # 修改时区
</code></pre>

<hr />

<h1 id="创建模型">创建模型</h1>

<p>django 推崇 Don’t repeat yourself (DRY) 原则，数据库迁移脚本中的模型将完全来源于你在代码中定义的模型。数据库迁移脚本将自动从你编写的模型中推断出迁移命令，不需要自己手动编写。此处以 django 的教程 polls 来介绍如何编写模型的定义。</p>

<pre><code class="language-python">from django.db import models


class Question(models.Model):
    question_text = models.CharField(max_length=200)
    pub_date = models.DateTimeField('date published')


class Choice(models.Model):
    question = models.ForeignKey(Question, on_delete=models.CASCADE)
    choice_text = models.CharField(max_length=200)
    votes = models.IntegerField(default=0)
</code></pre>

<p>关于这些字段的意思和使用方法，可以参考我的另一篇博客 <a href="http://meik2333.com/index.php/archives/4/">Field types</a> 。</p>

<p>django 通过这些模型的定义代码来创建数据库表和创建访问 API ，但是首先，我们需要告诉我们的项目，我们创建了一个新的应用。</p>

<hr />

<h1 id="激活模型">激活模型</h1>

<p>为了将应用包含在我们的项目中，我们需要在 settings.py 中添加其配置。以 polls 应用为例： polls 的 PollsConfig 包含在 polls/apps.py 文件中，其对应的路径为 &lsquo;polls.apps.PollsConfig&rsquo; ，编辑 settings.py 文件，将其添加至 INSTALLED_APPS 中：</p>

<pre><code class="language-python">INSTALLED_APPS  =  [ 
    'polls.apps.PollsConfig' ，
    'django.contrib.admin' ，
    'django.contrib.auth' ，
    'django.contrib.contenttypes' ，
    'django.contrib.sessions' ，
    'django.contrib.messages' ，
    'django.contrib.staticfiles' ，
]
</code></pre>

<p>现在 django 项目已经知道应该包含 polls 应用，此时运行另一个命令：</p>

<pre><code class="language-shell">python manage.py makemigrations polls
</code></pre>

<p>通知 django 已经对模型进行了修改，重新生成数据库迁移脚本，可以通过以下命令进行查看：</p>

<pre><code class="language-shell">python manage.py sqlmigrate polls 0001
</code></pre>

<p>之后，重新运行数据库迁移脚本以使刚刚对模型的修改生效。</p>

<pre><code class="language-shell">python manage.py migrate
</code></pre>

<p>请记住进行模型修改需要做的三个步骤：</p>

<ol>
<li>修改你的模型（models.py）</li>
<li>创建迁移脚本 python manage.py makemigrations</li>
<li>运行迁移脚本 python manage.py migrate</li>
</ol>

<hr />

<h1 id="playing-with-the-api">Playing with the API</h1>

<p>请参阅<a href="https://docs.djangoproject.com/en/2.0/intro/tutorial02/#playing-with-the-api">官方文档</a> 。</p>

<hr />

<h1 id="创建管理员用户">创建管理员用户</h1>

<pre><code class="language-shell">python manage.py createsuperuser
</code></pre>

<p>按照提示输入账号密码与邮箱即可。</p>

<hr />

<h1 id="在管理页面显示自己的模型">在管理页面显示自己的模型</h1>

<p>为了在 django 自带的 admin 中管理我们自己创建的模型，需要将模型注册到 admin ，修改 polls/admin.py</p>

<pre><code class="language-python">from django.contrib import admin

from .models import Question

admin.site.register(Question)
</code></pre>

<hr />

<h1 id="render">render()</h1>

<p>一个视图的函数应该返回一个 Response 对象，然而在返回一个渲染后的模板时，我们却不需要费力去自己构建一个 Response 对象。</p>

<pre><code class="language-python">from django.shortcuts import render

from .models import Question


def index(request):
    latest_question_list = Question.objects.order_by('-pub_date')[:5]
    context = {'latest_question_list': latest_question_list}
    return render(request, 'polls/index.html', context)
</code></pre>

<hr />

<h1 id="get-object-or-404">get_object_or_404()</h1>

<p>我们可能会需要在没有找到一个对象的时候给出 404 的错误，这时候 get_object_or_404() 就很有用了。</p>

<pre><code class="language-python">from django.shortcuts import get_object_or_404, render

from .models import Question
# ...
def detail(request, question_id):
    question = get_object_or_404(Question, pk=question_id)
    return render(request, 'polls/detail.html', {'question': question})
</code></pre>

<hr />

<h1 id="为-urls-模块命名">为 urls 模块命名</h1>

<p>如果您开发的项目中包含多个应用，那么这些应用之中可能包含了相同 name 的 url ，可以通过给 urls 命名的方式防止在模板中引用的时候冲突。</p>

<pre><code class="language-python"># polls/urls.py
from django.urls import path

from . import views

app_name = 'polls'
urlpatterns = [
    path('', views.index, name='index'),
    path('&lt;int:question_id&gt;/', views.detail, name='detail'),
    path('&lt;int:question_id&gt;/results/', views.results, name='results'),
    path('&lt;int:question_id&gt;/vote/', views.vote, name='vote'),
]
</code></pre>

<pre><code class="language-html"># polls/templates/polls/index.html
&lt;li&gt;&lt;a href=&quot;{% url 'polls:detail' question.id %}&quot;&gt;{{ question.question_text }}&lt;/a&gt;&lt;/li&gt;
</code></pre>

<hr />

<h1 id="一个简单的-form-示例">一个简单的 form 示例</h1>

<p>{% raw %}</p>

<pre><code class="language-html">&lt;h1&gt;{{ question.question_text }}&lt;/h1&gt;

{% if error_message %}&lt;p&gt;&lt;strong&gt;{{ error_message }}&lt;/strong&gt;&lt;/p&gt;{% endif %}

&lt;form action=&quot;{% url 'polls:vote' question.id %}&quot; method=&quot;post&quot;&gt;
{% csrf_token %}
{% for choice in question.choice_set.all %}
    &lt;input type=&quot;radio&quot; name=&quot;choice&quot; id=&quot;choice{{ forloop.counter }}&quot; value=&quot;{{ choice.id }}&quot; /&gt;
    &lt;label for=&quot;choice{{ forloop.counter }}&quot;&gt;{{ choice.choice_text }}&lt;/label&gt;&lt;br /&gt;
{% endfor %}
&lt;input type=&quot;submit&quot; value=&quot;Vote&quot; /&gt;
&lt;/form&gt;
</code></pre>

<p>django 的表单提交默认有 csrf 防跨站检测，需要在 form 中添加 {% csrf_token %} 以自动添加一个隐藏的 csrf 字段。
{% endraw %}</p>

<hr />

<h1 id="测试">测试</h1>

<p>django 中的<a href="https://docs.djangoproject.com/en/2.0/intro/tutorial05/">测试</a></p>

<hr />

<h1 id="自定义管理表单">自定义管理表单</h1>

<p>django 自带的 admin 功能及其强大，通过自定义，可以实现很多强大的功能。</p>

<p>这一章的篇幅较长且操作较为分散，直接给出官网的<a href="https://docs.djangoproject.com/en/2.0/intro/tutorial07/">文档</a> 。</p>

<p>如果想要做深入的 admin 的自定义，那么可以看一下下面三个文档：</p>

<ol>
<li><p><a href="https://docs.djangoproject.com/en/2.0/ref/contrib/admin/">The Django admin site</a></p></li>

<li><p><a href="https://docs.djangoproject.com/en/2.0/ref/contrib/admin/actions/">Admin actions</a></p></li>

<li><p><a href="https://docs.djangoproject.com/en/2.0/ref/contrib/admin/admindocs/">The Django admin documentation generator</a></p></li>
</ol><ul class="pa0">
  
   <li class="list">
     <a href="/tags/python" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Python</a>
   </li>
  
   <li class="list">
     <a href="/tags/django" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Django</a>
   </li>
  
</ul>
<div class="mt6">
      
      
      </div>
    </section>

    <aside class="w-30-l mt6-l">




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/posts/django-model-field-reference-field-options/">Django Model field reference - Field options</a>
        </li>
	    
	     <li  class="mb2">
          <a href="/posts/django-model-field-reference-field-types/">Django Model field reference - Field types</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://meik2333.com" >
    &copy; 2019 MeiK&#39;s blog
  </a>
    <div>










</div>
  </div>
</footer>

    

  <script src="/dist/js/app.3fc0f988d21662902933.js"></script>


  </body>
</html>
