<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <link crossorigin="anonymous" media="all"
        integrity="sha512-4bmhxCob3U2WoK8HVl7UacoDdNejo+50BlGN9SdGtjXbsCQwp7uLtntLkL9a9CmgLPZ8L9lsOZL0ieINT9yHeA=="
        rel="stylesheet"
        href="https://github.githubassets.com/assets/frameworks-2fd1891c9e6292401a1a3de8bc3f747f.css" />
    <link crossorigin="anonymous" media="all"
        integrity="sha512-oF4BPgLoJ4I8H6vdTzR4cGdwAF4bC/bdeI7zsQ/xzUbUWc+JU6xeSbOxIgOyelZP+1ESc5qfwDKzYQfdDNlX5Q=="
        rel="stylesheet" href="https://github.githubassets.com/assets/github-5238587550334d8b43fd71226c6de55c.css" />
    <meta name="viewport" content="width=device-width">

    <title>OnlineJudge 评测原理与常见问题解答 - MeiK&#39;s blog</title>

    <meta name="description" content="">
    <link rel="assets" href="https://github.githubassets.com/">
    <link rel="mask-icon" href="https://github.githubassets.com/pinned-octocat.svg" color="#000000">
    <link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://meik2333.com/images/favicon.ico">
    <meta name="theme-color" content="#1e2327">
</head>

<body class="env-production emoji-size-boost page-responsive page-profile">
  <div class="position-relative js-header-wrapper ">
    <span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar">
        <span class="progress-pjax-loader-bar top-0 left-0" style="width: 0%;"></span>
    </span>
    <header class="Header js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner">
        <div class="Header-item d-none d-lg-flex">
            <a class="Header-link" href="https://meik2333.com/" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div
            class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden">
            <div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to"
                role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox"
                aria-expanded="false">
                <div class="position-relative">
                </div>
            </div>
        </div>
        <div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative">
            <a class="Header-link" href="https://meik2333.com/" aria-label="Homepage"
                data-ga-click="Header, go to dashboard, icon:logo">
                <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path fill-rule="evenodd"
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
                </svg>
            </a>
        </div>
        <div class="Header-item position-relative mr-0 d-none d-lg-flex">
            <details class="details-overlay details-reset">
                <summary class="Header-link" aria-label="View profile and more"
                    data-ga-click="Header, show menu, icon:avatar">
                    <img alt="" class="avatar" src="https://meik2333.com/images/avatar.png" height="20" width="20">
                </summary>
            </details>
        </div>
    </header>
</div>

<div id="start-of-content" class="show-on-focus"></div>
<div id="js-flash-container">
</div>
  
<div class="application-main " data-commit-hovercards-enabled="">
    <div itemscope="" itemtype="http://schema.org/SoftwareSourceCode" class="">
        <main id="js-repo-pjax-container" data-pjax-container="">
            <div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-0 pt-lg-4 ">
                <div class="repohead-details-container clearfix container-lg p-responsive d-none d-lg-block">
                    <div class="mb-3 d-flex">
                        <h1 class="public css-truncate float-none flex-auto width-fit pl-0">
                            <a class="avatar mr-1" href="https://meik2333.com/about/"><img
                                    src="https://meik2333.com/images/avatar.png" width="26" height="26"></a>
                            <span class="author"><a
                                    href="https://meik2333.com/">MeiK</a></span>
                            <span class="path-divider">/</span>
                            <strong itemprop="name" class="css-truncate-target" style="max-width: 410px"><a
                                    href="https://meik2333.com/posts/online-judge-faq/">OnlineJudge 评测原理与常见问题解答</a></strong>

                            <div class="d-block text-small text-gray">
                                Created <time-ago datetime="2018-12-14" class="no-wrap"
                                    title="Created at 2018/12/14">
                                    2018-12-14</time-ago>
                                <span class="file-info-divider"></span>
                                Modifyd <time-ago datetime="2018-12-14" class="no-wrap"
                                    title="Modifyd at 2018/12/14">
                                    2018-12-14</time-ago>
                            </div>
                        </h1>
                    </div>
                </div>




            </div>
            <div class="container-lg clearfix new-discussion-timeline experiment-repo-nav  p-responsive">
                <div class="repository-content ">
                    <div class="Box mt-3 position-relative">
                        <div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
                            <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                                1556 Words
                                
                            </div>
                        </div>

                        <div id="readme" class="Box-body readme blob instapaper_body js-code-block-container">
                            <article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><p>总会有人在群里问：“这个程序在我本地是正确的，但是提交到 OJ 上错误了”或者“本地 AC 但是提交 WA”。今天我来给大家讲解一下 OJ 的评测原理，以及对一些出现频率较高的问题进行解答。</p>

<p>建议在看本文之前先看一下这篇经典的文章：<a href="/2018/02/24/（转）提问的智慧/">《提问的智慧》</a>。</p>

<h2 id="onlinejudge-的评测原理">OnlineJudge 的评测原理</h2>

<p>OJ 评测一个用户代码大概分为以下几步：</p>

<ol>
<li>编译代码</li>
<li>重定向输入输出，运行用户程序</li>
<li>对比用户程序输出和标准答案</li>
</ol>

<h3 id="资源限制">资源限制</h3>

<p>如果用户不小心提交了死循环的话，我们肯定不能一直等着它结束，因此要使用某种方式来限制用户程序占用的资源。</p>

<p>需要限制的主要是：占用时间、占用内存、输出文件大小等。</p>

<h3 id="权限限制">权限限制</h3>

<p>在服务器上运行用户提交的代码是很危险的，如果用户提交的一个 <code>system('rm -rf /')</code> 被执行了，那就瞬间爆炸了。或者通过 <code>#include</code> 来引用一些密码文件，然后在编译信息中有服务器密码等信息，也会导致相当危险的情况。</p>

<p>因此对用户提交的程序的运行权限要做严格的控制，常用的手段有创建专门用于评测的用户、使用 Docker 进行限制、限制 <code>syscall</code> 等。</p>

<h3 id="输入输出">输入输出</h3>

<p>有些 OJ 要求用户手动打开文件读取，并将输出写入文件。但大部分 OJ （包括 SDUTOJ）的做法都是通过重定向输入输出流，来让程序可以从 <code>stdin</code> 读、输出到 <code>stdout</code>，这样用户就不需要使用文件读写等操作了。</p>

<h3 id="对比答案">对比答案</h3>

<p>这里就要祭出我当年画的 OJ 评测流程图了。</p>

<p><img src="/images/online-judge-faq/oj.png" alt="" />（虽然有 csdn 的水印，但是是我自己画的图）</p>

<h3 id="完整实现">完整实现</h3>

<p><a href="https://github.com/MeiK2333/JudgeLight">这里</a>是一个 OJ 评测姬核心的完整实现，关键注释齐全，可以用作参考。</p>

<h2 id="常见问题解答">常见问题解答</h2>

<p>首先，所有的问题其实都是：</p>

<p><img src="/images/online-judge-faq/ojgg.png" alt="" /></p>

<p>用户是不可能出问题的，所有的问题都是 OJ 的问题。下面的问题解答针对的是某个不知名的平行世界，在那个世界里：</p>

<p><img src="/images/online-judge-faq/yougg.png" alt="" /></p>

<h3 id="为什么我本地-ac-提交却-wa-了">为什么我本地 AC，提交却 WA 了</h3>

<p>首先要明确，没有本地 AC 这种操作。如果你本地就能 AC，那么何必将代码提交到 OJ 上呢。</p>

<p>如果你说的是你的代码在你本地通过了测试数据的考验，但是提交到 OJ 却出错了：这是非常正常的。OJ 上给定的测试数据仅仅是其中一组数据，实际评测时会参照的可并不只有这一组数据。</p>

<p>当你发现本地通过测试而提交 WA 时，你应该做的是检查你的代码在不同的边缘数据时的表现，而不是去群里抱怨你“本地 AC”。</p>

<p>当然，有时候确实是题目或者数据出了问题，不过这个时候 OJ 和评测姬也是不背锅的。请找到对应题目的出题人，然后狠狠地把错误拍他脸上。</p>

<h3 id="为什么我本地-ac-提交却-ce-了">为什么我本地 AC，提交却 CE 了</h3>

<p>OJ 评测姬的系统环境是 Linux，因此如果你使用了某些平台专属的操作（比如 <code>#include &lt;Windows.h&gt;</code>）的话就会 GG。</p>

<p>当然， 80% 的可能是你的代码写的有问题，你本地能运行只是你的编译器帮你做了一点优化。</p>

<p>这里列举一些常见的错误：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {}  <span style="color:#75715e">// 错误！main 的返回值必须为 int
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() { <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>; }  <span style="color:#75715e">// 非零返回值的 main 函数可能让你的程序直接判错
</span><span style="color:#75715e"></span>
printf(<span style="color:#e6db74">&#34;%lf</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, ans);  <span style="color:#75715e">// 输出的时候没有 %lf 这种操作，请使用 %f
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> cnt; cout <span style="color:#f92672">&lt;&lt;</span> cnt <span style="color:#f92672">&lt;&lt;</span> endl;  <span style="color:#75715e">// 未初始化的变量的值是未定义的，也就是说，它可能是任何值
</span></code></pre></div>
<h3 id="为什么我的提交-se-了">为什么我的提交 SE 了</h3>

<p>SE（System Error）顾名思义是系统错误，这个错误一般和你的代码没啥关系。但是如果你发现你的某个代码只要提交就稳定 SE 的话，那么你最好检查一下你的代码里有没有非法字符。</p>

<h3 id="为什么我本地-wa-提交却-ac-了">为什么我本地 WA，提交却 AC 了</h3>

<p>如果你的代码中有 UB（undefined behavior，未定义行为）的话，那么你提交的程序可能返回任意结果。</p>

<p>常见的 UB：变量未初始化、访问越界数组、<code>func(a++, b++, a--)</code> 、除零、函数未写返回值等操作。</p>

<h3 id="道理我都懂但是我要怎么减少这些错误">道理我都懂但是我要怎么减少这些错误</h3>

<p>一句话：不要 xjb 乱写，加上看看课本，就能在绝大部分情况下避免这些神奇错误。</p>

<p>我在初学阶段，总是先看一遍书再敲代码，在运行之前就已经知道其运行过程与结果了。这并不是多么难的东西，你要知道，大部分情况下，你翻一下课本，能比去群里跪求大佬收获更多。</p>

<p>另外，如果你使用和 OJ 相近的环境，可以在一定程度上减少这些错误。关于如何配置环境，可以看我写的<a href="https://github.com/sdutacm/cpp-style-guide">《
C/C++ 代码风格指导》</a>，里面有配置环境的方法与一些敲代码的指导。</p></article>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

  <div class="footer container-lg width-full p-responsive" role="contentinfo">
    <div
        class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
            <li class="mr-3 mr-lg-0">© 2019. Theme by <a href="https://github.com/MeiK2333/github-style"><span>github-style</span></a></li>
        </ul>

        <a aria-label="Homepage" title="MeiK&#39;s blog" class="footer-octicon d-none d-lg-block mx-lg-4"
            href="https://meik2333.com/">
            <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
        </a>
        <ul
            class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        </ul>
    </div>
    <div class="d-flex flex-justify-center pb-6">
        <span class="f6 text-gray-light"></span>
    </div>
</div>

<script crossorigin="anonymous"
    integrity="sha512-P7QbxhTkfogU8wuMH3u9CEiNA9esk13jExiHBnpW+Kh9fKban2yNVEok9xzV2GqSuEU3ZbCKe0GooUfc6szm4g=="
    type="application/javascript" src="https://github.githubassets.com/assets/frameworks-e0eb4964.js"></script>

<script crossorigin="anonymous" async="async"
    integrity="sha512-UjV5G8yJkGcA9OW3TPPQx+Rk3uyOfOVmYEWLj7ADv81bEy8Jp9oDULYFdQxOxJq518DFlt0+dBqobwvarLrNgA=="
    type="application/javascript" src="https://github.githubassets.com/assets/github-bootstrap-35e32afb.js"></script>
<script>
    let classs = ['pinned-item-desc', 'text-gray', 'text-small', 'd-block', 'mt-2', 'mb-3'];
    const pinned_posts = document.getElementsByName('pinned-post');
    for (let i = 0; i < pinned_posts.length; i++) {
        for (let j = 0; j < classs.length; j++) {
            const ps = pinned_posts[i].getElementsByTagName('p');
            for (let k = 0; k < ps.length; k++) {
                ps[k].classList.add(classs[j]);
            }
        }
    }
    classs = [ 'd-inline-block', 'text-gray', 'mb-2', 'pr-4'];
    const posts_posts = document.getElementsByName('posts-post');
    for (let i = 0; i < posts_posts.length; i++) {
        for (let j = 0; j < classs.length; j++) {
            const ps = posts_posts[i].getElementsByTagName('p');
            for (let k = 0; k < ps.length; k++) {
                ps[k].classList.add(classs[j]);
            }
        }
    }
</script>
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-107784973-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</body>

</html>