<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script type="application/javascript" src='https://meik2333.com/js/theme-mode.js'></script>
    <link rel="stylesheet" href='https://meik2333.com/css/frameworks.min.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/github.min.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/github-style.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/light.css' />
    <link rel="stylesheet" href='https://meik2333.com/css/dark.css' />
    <title>Python 中的单元测试（ unittest 的基础用法） - MeiK&#39;s blog</title>
    <link rel="icon" type="image/x-icon" href='https://meik2333.com/images/favicon.ico'>
    <meta name="theme-color" content="#1e2327">

    
    <meta name="description"
  content="“单元测试（unit testing），是指对软件中的最小可测试单元进行检查和验证。”—— 百度百科
" />
<meta name="keywords"
  content='' />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://meik2333.com/post/unit-testing-in-python/" />


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="Python 中的单元测试（ unittest 的基础用法） - MeiK&#39;s blog" />
<meta name="twitter:description"
  content="“单元测试（unit testing），是指对软件中的最小可测试单元进行检查和验证。”—— 百度百科
" />
<meta name="twitter:site" content="https://meik2333.com/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image"
  content="https://meik2333.com/">


<meta property="og:type" content="article" />
<meta property="og:title" content="Python 中的单元测试（ unittest 的基础用法） - MeiK&#39;s blog">
<meta property="og:description"
  content="“单元测试（unit testing），是指对软件中的最小可测试单元进行检查和验证。”—— 百度百科
" />
<meta property="og:url" content="https://meik2333.com/post/unit-testing-in-python/" />
<meta property="og:site_name" content="Python 中的单元测试（ unittest 的基础用法）" />
<meta property="og:image"
  content="https://meik2333.com/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2018-02-23 00:23:00 &#43;0000 UTC" />










</head>

<body>
  <div style="position: relative">
  <header class="Header js-details-container Details px-3 px-md-4 px-lg-5 flex-wrap flex-md-nowrap open Details--on">
    <div class="Header-item mobile-none" style="margin-top: -4px; margin-bottom: -4px;">
      <a class="Header-link" href="https://meik2333.com/">
        <svg class="octicon" height="32" viewBox="0 0 16 16" version="1.1" width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item d-md-none">
      <button class="Header-link btn-link js-details-target" type="button"
        onclick="document.querySelector('#header-search').style.display = document.querySelector('#header-search').style.display == 'none'? 'block': 'none'">
        <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24">
          <path fill-rule="evenodd"
            d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z">
          </path>
        </svg>
      </button>
    </div>
    <div style="display: none;" id="header-search"
      class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
      <div
        class="Header-search header-search flex-auto js-site-search position-relative flex-self-stretch flex-md-self-auto mb-3 mb-md-0 mr-0 mr-md-3 scoped-search site-scoped-search js-jump-to">
        <div class="position-relative">
          <form target="_blank" action="https://www.google.com/search" accept-charset="UTF-8" method="get"
            autocomplete="off">
            <label
              class="Header-search-label form-control input-sm header-search-wrapper p-0 js-chromeless-input-container header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center">
              <input type="text"
                class="Header-search-input form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
                name="q" value="" placeholder="Search" autocomplete="off">
              <input type="hidden" name="q" value="site:https://meik2333.com/">
            </label>
          </form>
        </div>
      </div>
    </div>

    <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
      <a class="Header-link " href="https://meik2333.com/">
        <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
          width="32">
          <path fill-rule="evenodd"
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
          </path>
        </svg>
      </a>
    </div>
    <div class="Header-item" style="margin-right: 0;">
      <a href="javascript:void(0)" class="Header-link no-select" onclick="switchTheme()">
        <svg style="fill: var(--color-profile-color-modes-toggle-moon);" class="no-select" viewBox="0 0 16 16"
          version="1.1" width="16" height="16">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M4.52208 7.71754C7.5782 7.71754 10.0557 5.24006 10.0557 2.18394C10.0557 1.93498 10.0392 1.68986 10.0074 1.44961C9.95801 1.07727 10.3495 0.771159 10.6474 0.99992C12.1153 2.12716 13.0615 3.89999 13.0615 5.89383C13.0615 9.29958 10.3006 12.0605 6.89485 12.0605C3.95334 12.0605 1.49286 10.001 0.876728 7.24527C0.794841 6.87902 1.23668 6.65289 1.55321 6.85451C2.41106 7.40095 3.4296 7.71754 4.52208 7.71754Z">
          </path>
        </svg>
      </a>
    </div>
  </header>
</div>
  
<div>
  <main>
    <div class="gisthead pagehead bg-gray-light pb-0 pt-3 mb-4">
      <div class="px-0">
        <div class="mb-3 d-flex px-3 px-md-3 px-lg-5">
          <div class="flex-auto min-width-0 width-fit mr-3">
            <div class="d-flex">
              <div class="d-none d-md-block">
                <a class="avatar mr-2 flex-shrink-0" href="https://meik2333.com/">
                  <img class=" avatar-user"
                    src="https://meik2333.com/images/avatar.png"
                    width="32" height="32"></a>
              </div>
              <div class="d-flex flex-column">
                <h1 class="break-word f3 text-normal mb-md-0 mb-1">
                  <span class="author">
                    <a href="https://meik2333.com/">MeiK</a></span><span
                    class="path-divider">/</span><strong class="css-truncate-target mr-1" style="max-width: 410px"><a
                      href="https://meik2333.com/post/unit-testing-in-python/">Python 中的单元测试（ unittest 的基础用法）</a></strong>
                </h1>
                <div class="note m-0">
                  Created <relative-time datetime="Fri, 23 Feb 2018 00:23:00 &#43;0000"
                    class="no-wrap">
                    Fri, 23 Feb 2018 00:23:00 &#43;0000</relative-time>

                  
                  <span class="file-info-divider"></span>
                  Modified <relative-time datetime="Fri, 11 Oct 2019 16:30:29 &#43;0800"
                    class="no-wrap">
                    Fri, 11 Oct 2019 16:30:29 &#43;0800</relative-time>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-lg px-3 new-discussion-timeline">
      <div class="repository-content gist-content">
        <div>
          <div class="js-gist-file-update-container js-task-list-container file-box">
            <div id="file-pytest" class="file my-2">
              <div class="file-header d-flex flex-md-items-center flex-items-start">
                <div class="file-info d-flex flex-md-items-center flex-items-start flex-order-1 flex-auto">
                  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">
                    1613 Words
                    

                  </div>
                  <div class="file-actions flex-order-2 pt-0">
                    
                    
                    <a class="muted-link mr-3" href="/tags/python">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      Python
                    </a>
                    
                    <a class="muted-link mr-3" href="/tags/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">
                      <svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16">
                        <path fill-rule="evenodd"
                          d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z">
                        </path>
                      </svg>
                      单元测试
                    </a>
                    
                    
                  </div>
                </div>
              </div>


              <div class="Box-body px-5 pb-5">
                <article class="markdown-body entry-content container-lg"><p>“单元测试（unit testing），是指对软件中的最小可测试单元进行检查和验证。”—— 百度百科</p>

<h1 id="学习背景">学习背景</h1>

<p>作为一个敲代码纯靠脑补的鶸，之前在阅读某开源规范时看到，没有完备的单元测试的项目是不安全的。然而学习编程这两年多以来从来没有在自己的代码中使用过单元测试。这次学习 django ，文档中又强调了单元测试的重要性，借此机会，学习一下单元测试。</p>

<hr />

<h1 id="介绍">介绍</h1>

<p>Python 中，单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>

<p>对于一个已有的（或者还没有的）函数或类，构造出一些输入数据，然后验证其运行的结果与我们预期的是否相同，从而判断这个模块编写是否正确。同时，如果后续修改更新了这些代码，只要简单的运行一遍单元测试，就可以知道之前的修改是否对原有功能造成了破坏。</p>

<p>单元测试不仅可以用于已有代码的测试，也可以用于指明开发方向。有一个著名的理念就是“测试驱动开发”，大概就是说先用单元测试描述想法，然后再去开发对应的代码。</p>

<hr />

<h1 id="一个小例子">一个小例子</h1>

<p>比如我们现在有一个函数 <code>abs()</code> ，用于求输入的绝对值，那么我们可以构造一些测试用例：</p>

<ol>
<li><p>输入正数，比如 <code>1</code> 、 <code>1.2</code> 、 <code>0.99</code> ，期待返回值与输入相同；</p></li>

<li><p>输入负数，比如 <code>-1</code> 、 <code>-1.2</code> 、 <code>-0.99</code> ，期待返回值与输入相反；</p></li>

<li><p>输入 <code>0</code> ，期待返回 <code>0</code> ；</p></li>

<li><p>输入非数值类型，比如 <code>None</code> 、 <code>[]</code> 、 <code>{}</code> ，期待抛出 <code>TypeError</code> 。</p></li>
</ol>

<p>把上面的测试用例放到一个测试模块里，就是一个完整的单元测试。</p>

<p>如果单元测试通过，说明我们测试的这个函数能够正常工作。如果单元测试不通过，要么函数有bug，要么测试条件输入不正确，总之，需要修复使单元测试能够通过。</p>

<p>我这里直接引用廖雪峰老师的<a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143191629979802b566644aa84656b50cd484ec4a7838000">教程</a>里面的一个例子：</p>

<hr />

<p>我们来编写一个 <code>Dict</code> 类，这个类的行为和 <code>dict</code> 一致，但是可以通过属性来访问，用起来就像下面这样：</p>

<pre><code class="language-python">&gt;&gt;&gt; d = Dict(a=1, b=2)
&gt;&gt;&gt; d['a']
1
&gt;&gt;&gt; d.a
1
</code></pre>

<p>mydict.py 代码如下：</p>

<pre><code class="language-python">class Dict(dict):

    def __init__(self, **kw):
        super().__init__(**kw)

    def __getattr__(self, key):
        try:
            return self[key]
        except KeyError:
            raise AttributeError(r&quot;'Dict' object has no attribute '%s'&quot; % key)

    def __setattr__(self, key, value):
        self[key] = value
</code></pre>

<p>为了编写单元测试，我们需要引入Python自带的 <code>unittest</code> 模块，编写 <code>mydict_test.py</code> 如下：</p>

<pre><code class="language-python">import unittest

from mydict import Dict

class TestDict(unittest.TestCase):

    def test_init(self):
        d = Dict(a=1, b='test')
        self.assertEqual(d.a, 1)
        self.assertEqual(d.b, 'test')
        self.assertTrue(isinstance(d, dict))

    def test_key(self):
        d = Dict()
        d['key'] = 'value'
        self.assertEqual(d.key, 'value')

    def test_attr(self):
        d = Dict()
        d.key = 'value'
        self.assertTrue('key' in d)
        self.assertEqual(d['key'], 'value')

    def test_keyerror(self):
        d = Dict()
        with self.assertRaises(KeyError):
            value = d['empty']

    def test_attrerror(self):
        d = Dict()
        with self.assertRaises(AttributeError):
            value = d.empty
</code></pre>

<p>编写单元测试时，我们需要编写一个测试类，从 <code>unittest.TestCase</code> 继承。</p>

<p>以 <code>test</code> 开头的方法就是测试方法，不以 <code>test</code> 开头的方法不被认为是测试方法，测试的时候不会被执行。</p>

<p>对每一类测试都需要编写一个 <code>test_xxx()</code> 方法。由于 <code>unittest.TestCase</code> 提供了很多内置的条件判断，我们只需要调用这些方法就可以断言输出是否是我们所期望的。最常用的断言就是 <code>assertEqual()</code> ：</p>

<pre><code class="language-python">self.assertEqual(abs(-1), 1) # 断言函数返回的结果与1相等
</code></pre>

<p>另一种重要的断言就是期待抛出指定类型的Error，比如通过 <code>d['empty']</code> 访问不存在的key时，断言会抛出 <code>KeyError</code> ：</p>

<pre><code class="language-python">with self.assertRaises(KeyError):
    value = d['empty']
</code></pre>

<p>而通过 <code>d.empty</code> 访问不存在的key时，我们期待抛出 <code>AttributeError</code>：</p>

<pre><code class="language-python">with self.assertRaises(AttributeError):
    value = d.empty
</code></pre>

<hr />

<h1 id="运行单元测试">运行单元测试</h1>

<p>通过在代码中添加 <code>unittest.main()</code> ，可以通过命令行的形式执行单元测试。也就是在写的测试文件底部添加：</p>

<pre><code class="language-python">if __name__ == '__main__':
    unittest.main()
</code></pre>

<p>单元测试可以直接作为 Python 脚本执行：</p>

<pre><code class="language-shell">python mydict_test.py
</code></pre>

<p>也可以在命令行通过参数 <code>-m unittest</code> 直接运行单元测试：</p>

<pre><code class="language-shell">python -m unittest mydict_test
</code></pre>

<p>推荐使用第二种方式执行，因为通过这种方式可以同时运行多个测试文件，也可以通过添加参数获得一些其他的功能。比如添加 <code>-v</code> 选项以获得更详细的提示。</p>

<pre><code class="language-shell">python -m unittest -v mydict_test
</code></pre>

<p>通过 <code>-h</code> 选项可以获得所有可使用的选项。</p>

<hr />

<h1 id="setup与teardown">setUp与tearDown</h1>

<p>可以在单元测试中编写两个特殊的 <code>setUp()</code> 和 <code>tearDown()</code> 方法。这两个方法会分别在每调用一个测试方法的前后分别被执行。</p>

<p><code>setUp()</code> 和 <code>tearDown()</code> 方法有什么用呢？设想你的测试需要启动一个数据库，这时，就可以在 <code>setUp()</code> 方法中连接数据库，在 <code>tearDown()</code> 方法中关闭数据库，这样，不必在每个测试方法中重复相同的代码。即使测试出错， <code>tearDown()</code> 也会执行。</p>

<hr />

<h1 id="跳过测试以及异常测试">跳过测试以及异常测试</h1>

<p>unittest 支持跳过单独的测试方法或者整个类，也支持条件测试或者 expected failure （期望一个错误）测试。</p>

<pre><code class="language-python">import unittest
import sys


class TestCase(unittest.TestCase):
    # 此测试将被跳过
    @unittest.skip('demonstrating sipping')
    def test_nothing(self):
        self.fail(&quot;shouldn't happen&quot;)

    # 此测试将仅在 Windows 下执行
    @unittest.skipUnless(sys.platform.startswith(&quot;win&quot;), 'requires Windows')
    def test_windows_support(self):
        pass

    # 此测试期望出现错误
    @unittest.expectedFailure
    def test_format(self):
        self.assertEqual(True, False)


if __name__ == '__main__':
    unittest.main()
</code></pre>

<p>被跳过的测试不会执行 <code>setUp()</code> 和 <code>tearDown()</code> 方法。</p>

<hr />

<h1 id="参考">参考</h1>

<p>本篇博客参考了以下文章：</p>

<ol>
<li><p>廖雪峰老师的教程：<a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143191629979802b566644aa84656b50cd484ec4a7838000">单元测试</a></p></li>

<li><p>简书用户 cheneydc 的文章：<a href="https://www.jianshu.com/p/4a17a3040f07">Python单元测试-unittest</a></p></li>

<li><p>unittest <a href="https://docs.python.org/2/library/unittest.html">官方文档</a></p></li>
</ol></article>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

  <div class="footer container-xl width-full p-responsive">
  <div
    class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between flex-sm-items-center pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mr-lg-4" href="https://meik2333.com/">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24">
        <path fill-rule="evenodd"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
        </path>
      </svg>
    </a>
    <ul class="list-style-none d-flex flex-wrap col-12 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      
      <li class="mr-3 mr-lg-0">Theme by <a href='https://github.com/MeiK2333/github-style'>github-style</a></li>
      
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>


</div>
</body>

<script type="application/javascript" src="https://meik2333.com/js/github-style.js"></script>



</html>